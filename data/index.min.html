<!DOCTYPE html><html lang="lt"><head><meta charset="UTF-8"><title>Katilo temperatūra --.-°C</title><style>html{--fg-color:#eee;--bg-color:#111;--primary-color-hsl:0, 70%, 75%;--primary-color:hsl(var(--primary-color-hsl));--primary-color-30:hsla(var(--primary-color-hsl), .3);--primary-color-60:hsla(var(--primary-color-hsl), .6);--primary-color-80:hsla(var(--primary-color-hsl), .8);--primary-color-90:hsla(var(--primary-color-hsl), .9);scrollbar-color:var(--primary-color-90) var(--bg-color)}::-webkit-scrollbar{height:16px;width:16px}::-webkit-scrollbar-track{background:var(--bg-color)}::-webkit-scrollbar-thumb{background:var(--primary-color-90)}::-webkit-scrollbar-thumb:hover{background:var(--primary-color-60)}::-webkit-scrollbar-thumb:active{background:var(--primary-color-30)}@media (prefers-color-scheme: light){html{--fg-color:#111;--bg-color:#eee}::-webkit-scrollbar-thumb{background:var(--primary-color-60)}::-webkit-scrollbar-thumb:hover{background:var(--primary-color-80)}::-webkit-scrollbar-thumb:active{background:var(--primary-color)}}body{font-family:Arial,Helvetica,sans-serif;background:var(--bg-color);color:var(--fg-color);margin:0;padding:0 1em}main{display:block;overflow:hidden;position:relative;width:100%}section{margin:0 auto;width:100%;max-width:90em;padding-top:1em}.huge{font-size:8em;font-weight:bolder;line-height:0.9}.center{text-align:center}.temp{display:inline-block;text-align:left}.chartWrapper{position:relative;overflow-x:auto;width:100%}.chartContainer{position:relative;height:35em}</style> <script src="https://cdn.jsdelivr.net/npm/chart.js@3.4.1/dist/chart.min.js" integrity="sha256-GMN9UIJeUeOsn/Uq4xDheGItEeSpI5Hcfp/63GclDZk=" crossorigin="anonymous"></script> <script>const tempPollMS=15000;const histPollMS=300000;var lastUpdateTemp=0;var lastUpdateChart=0;var hist=[];var histChart;const updateTemp=()=>{lastUpdateTemp=Date.now();fetch("temp").then(res=>res.json()).then(data=>{let temp=data.tempC.toFixed(1);document.title=`Katilo temperatūra ${temp}°C`;document.getElementById("temp").innerText=temp;}).catch(reason=>console.log(reason));};const updateHistFull=()=>{lastUpdateChart=Date.now();updateHist(0,14,true);};const updateHistLatest=()=>{lastUpdateChart=Date.now();updateHist(0,1);};const updateHist=(from,n,scroll=false)=>{if(from>=n){return;} fetch("hist/"+from).then(res=>{if(!res.ok){throw new Error("Not 2xx response");} return res.text();}).then(body=>parseHist(body)).then(data=>{for(let i=0;i<data.length;i++){appendHist(data[i]);} updateHistChart();if(scroll){scrollToEnd();} updateHist(from+1,n,scroll);}).catch(reason=>console.log(reason));};const updateHistChart=()=>{histChart.data.labels=[];histChart.data.datasets[0].data=[];for(let i=0;i<hist.length;i++){let label=hist[i].date.toLocaleString("lt",{month:"long",day:"numeric",hour:"numeric",minute:"numeric"});label=label.charAt(0).toUpperCase()+label.slice(1);histChart.data.labels.push(label);histChart.data.datasets[0].data.push(hist[i].temp);} let e=document.getElementById("hist");e.parentElement.style.width=(hist.length*0.6)+"em";histChart.update();};const appendHist=(v)=>{let i;for(i=0;i<hist.length;i++){if(hist[i].date.getTime()==v.date.getTime()){return;} if(hist[i].date.getTime()>v.date.getTime()){break;}} hist=[...hist.slice(0,i),v,...hist.slice(i)];};const parseHist=(body)=>{let data=[];let lines=body.split("\n");for(let i=0;i<lines.length;i++){let parts=lines[i].split(",");if(parts.length!=2){continue;} data.push({date:new Date(+parts[0].substr(0,4),+parts[0].substr(5,2)-1,+parts[0].substr(8,2),+parts[0].substr(11,2),+parts[0].substr(14,2)),temp:+parts[1]});} return data;};const scrollToEnd=()=>{let e=document.getElementById("hist").parentElement.parentElement;e.scrollLeft=e.scrollWidth;};window.addEventListener("focus",()=>{if(Date.now()-lastUpdateTemp>tempPollMS*2){updateTemp();} if(Date.now()-lastUpdateChart>histPollMS*2){updateHistFull();}});window.addEventListener("load",()=>{var style=getComputedStyle(document.body);let primaryCol=style.getPropertyValue("--primary-color");let primaryColAlt=style.getPropertyValue("--primary-color-60");let fgCol=style.getPropertyValue("--fg-color");histChart=new Chart(document.getElementById("hist"),{type:"line",data:{datasets:[{fill:{target:"origin",above:primaryColAlt},pointHitRadius:48,pointBorderWidth:0,pointBackgroundColor:primaryCol,pointRadius:0,pointHoverRadius:8,borderWidth:4,borderColor:primaryCol,tension:0.5}]},options:{scales:{x:{grid:{color:fgCol+"2"}},y:{grid:{color:fgCol+"2"},position:"right",suggestedMax:80,suggestedMin:60}},plugins:{legend:{display:false},tooltip:{displayColors:false,callbacks:{label:ctx=>ctx.raw.toFixed(1)+"°C"}}},maintainAspectRatio:false}});updateTemp();updateHistFull();setInterval(updateTemp,tempPollMS);setInterval(updateHistLatest,histPollMS);});</script> </head><body> <main> <section id="temperature" class="center"><div class="temp"><h2 style="margin-bottom: 0; user-select: none;">Katilo temperatūra</h2> <span class="huge"><span id="temp">--.-</span>&deg;C</span></div> </section> <section id="history"><h2 style="user-select: none;">Istorija</h2><div class="chartWrapper"><div class="chartContainer"> <canvas id="hist"></canvas></div></div> </section> </main></body></html>
